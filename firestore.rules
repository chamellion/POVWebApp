rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ========================================
    // CLIENT-FACING COLLECTIONS
    // Public read access, authenticated write access
    // ========================================
    
    // Events collection - public read, authenticated write
    match /events/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Recurring Events collection - public read, authenticated write
    match /recurringEvents/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Skipped Recurring Events collection - public read, authenticated write
    match /skippedRecurringEvents/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Pastors collection - public read, authenticated write
    match /pastors/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Carousel collection - public read, authenticated write
    match /carousel/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // ========================================
    // NEWSLETTER SIGNUP COLLECTION
    // Special rules: public create, authenticated read
    // ========================================
    
    // Newsletter Signups collection - public create, authenticated read
    match /newsletterSignups/{document} {
      // Allow anyone to create a newsletter signup
      allow create: if 
        // Email field must exist and be a string
        request.resource.data.email is string &&
        request.resource.data.email.size() > 0 &&
        // Basic email format validation
        request.resource.data.email.matches('^[^@]+@[^@]+\\.[^@]+$');
      
      // Only authenticated users can read newsletter signups
      allow read: if request.auth != null;
      
      // Only authenticated users can update/delete
      allow update, delete: if request.auth != null;
    }
    
    // ========================================
    // ADMIN-ONLY COLLECTIONS
    // Authenticated read/write access only
    // ========================================
    
    // Gallery collection - authenticated access only
    match /gallery/{document} {
      allow read, write: if request.auth != null;
    }
    
    // Testimonies collection - authenticated access only
    match /testimonies/{document} {
      allow read, write: if request.auth != null;
    }
    
    // Settings collection - authenticated access only
    match /settings/{document} {
      allow read, write: if request.auth != null;
    }
    
    // Team leads collection - authenticated access only
    match /teamLeads/{document} {
      allow read, write: if request.auth != null;
    }
    
    // ========================================
    // DEFAULT RULE
    // Deny all other access by default
    // ========================================
    
    // Deny access to any collection not explicitly defined above
    match /{document=**} {
      allow read, write: if false;
    }
  }
} 